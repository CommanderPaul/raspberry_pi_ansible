--- # secure raspberry pi from default settings.
- name: Secure new raspberry pi
  hosts: my_pi
  remote_user: pi
  gather_facts: no
  become: yes

  vars:
    # username encrypted with ansible-vault
    username: !vault |
      $ANSIBLE_VAULT;1.1;AES256
      31333065663438306637323963626239616665613739323266306139653431353331396233663035
      3130313439346261353866356463613264646666623338330a376165333237396131303234656337
      32616332303864363461636239333834663466626562356337623564303031313434653563633230
      6638383035663866390a356437303963383039323665356333373439383363663133653063613365
      3365

    # encrypted public key just because
    user_key: !vault |
      $ANSIBLE_VAULT;1.1;AES256
      31643763393233373663656232663830383237613736356665666238653437353666663037313362
      6432316335633538613163343262376164343263353933370a306437366432363562666266343463
      38383731656462336163616332316533336261356433363437333766366666316263333964623066
      6533636233346439660a386534643738663839636136396663616239633031613031376361393835
      64643834663162336462396534656161306437383464363936303634363264333565323664373035
      64333438346134306131633239343330306535616537313338333337326532373339393633313131
      32376562633662616533616463363030626661633266343463323533373635306531343365646163
      36336237663635383933386639616632323338313131646633366432383433353439643831393165
      37636334343166323134616365373333383665393734643230393563643039353831333938623961
      64326537333438626636393761306333313337306435653333306431363834656437393065323961
      65363633613132326639336337656563313761386134623938333032323739396130636630613036
      66356533393334336131633762306334373865396536386634353438666239643130643031323139
      38663937646235313632656665646162356430633665626466373634653138643933623033626331
      61336566626338393737393664663164653537386637666537653131333635626161626330393735
      64316630663665613931626661303331366638313334633939343336663235643131306363393138
      66393066303566313433373935623234653038613732303531333030636265613738623238663064
      31646165623331376365666164383938613162346238323962623537353432663233

  roles:
    - create_admin_user
    - secure_sshd_config

    # after ssh restart, which is kind of slow,
    # pi username should no longer work for ssh login
